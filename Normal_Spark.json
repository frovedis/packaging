{"paragraphs":[{"text":"%spark\nimport org.apache.spark.mllib.linalg.{Vector, Vectors}\nimport org.apache.spark.mllib.linalg.Matrix\nimport org.apache.spark.mllib.linalg.distributed.RowMatrix\nimport org.apache.spark.mllib.linalg.SingularValueDecomposition\n\n\ndef createVector(line: String, size: Int) : Vector = {\n    val item = line.split(\" \")\n    val vlen = item.length\n    var data = Array.ofDim[Double](vlen)\n    var idx = Array.ofDim[Int](vlen)\n    for(i <- 0 until vlen) {\n      val idxdata = item(i).split(\":\")\n      idx(i) = idxdata(0).toInt\n      data(i) = idxdata(1).toDouble\n    }\n    Vectors.sparse(size, idx, data)\n}\n\nval size = 18162\nval vectors=sc.textFile(\"file://\" + sys.env(\"INSTALLPATH\") + \"/data/demo/ratings_matrix\",8).map(line=>createVector(line, size))\nval mat: RowMatrix = new RowMatrix(vectors)\n\nimport scala.io.Source\n\nval s = Source.fromFile(sys.env(\"INSTALLPATH\") + \"/data/demo/movielist\")\nval movielist = try s.getLines.toArray finally s.close","user":"anonymous","dateUpdated":"2018-06-16T16:04:51+0900","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1529132135026_1661543143","id":"20171026-130918_154948493","dateCreated":"2018-06-16T15:55:35+0900","dateStarted":"2018-06-16T16:04:51+0900","dateFinished":"2018-06-16T16:04:52+0900","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8008"},{"text":"%spark\n\nval k = 200\nval start = System.currentTimeMillis\nval svd: SingularValueDecomposition[RowMatrix, Matrix] = mat.computeSVD(k, computeU = true)\nprintf(\"%%html\\n<h3> Normal Spark: training time = %d sec</h3>\\n\", (System.currentTimeMillis - start)/1000)\nval U: RowMatrix = svd.U\nval s: Vector = svd.s\nval V: Matrix = svd.V","user":"anonymous","dateUpdated":"2018-06-16T16:09:28+0900","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1529132135026_1661543143","id":"20171026-130759_1322825160","dateCreated":"2018-06-16T15:55:35+0900","dateStarted":"2018-06-16T16:09:28+0900","dateFinished":"2018-06-16T16:11:35+0900","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8009"},{"text":"%spark\n\n//val userID = 135\nval userID = 5669\nval alreadyRated = mat.rows.zipWithIndex.map{case (k,v) => (v,k)}.lookup(userID)(0).toSparse\nval ratedPair = alreadyRated.values.zip(alreadyRated.indices).sorted.reverse.take(5)\nprintf(\"\\n%%html\\n<table border=1 style=\\\"font-size: 12pt;\\\">\\n<tr><th>Movies highly rated by user (ID:%d)</th></tr>\",userID)\nratedPair.map(t => printf(\"<tr><td>%s</td></tr>\",movielist(t._2)))\nprintf(\"</table>\\n\")\nval ratedSet = alreadyRated.indices.toSet\nval userVec = U.rows.zipWithIndex.map{case (k,v) => (v,k)}.lookup(userID)(0).toDense\nval userVec_s = userVec.toArray.zip(s.toArray).map(i => i._1 * i._2)\nval toRecommend = V.multiply(Vectors.dense(userVec_s)).toArray.zipWithIndex.sorted.reverse.take(5+ratedSet.size).filterNot(t => ratedSet.contains(t._2)).take(5)\nprintln(\"<br><table border=1 style=\\\"font-size: 12pt;\\\">\\n<tr><th>Recommending movies</th><th>Evalation</th></tr>\")\ntoRecommend.map(t => printf(\"<tr><td>%s</td><td>%.3f</td></tr>\",movielist(t._2),t._1))\nprintf(\"</table>\\n\")","user":"anonymous","dateUpdated":"2018-06-16T16:09:21+0900","config":{"tableHide":false,"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1529132135027_1661158394","id":"20171026-130829_1999845951","dateCreated":"2018-06-16T15:55:35+0900","dateStarted":"2018-06-16T16:09:21+0900","dateFinished":"2018-06-16T16:09:23+0900","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8010"},{"text":"%spark\n","dateUpdated":"2018-06-16T15:55:35+0900","config":{"editorSetting":{"language":"scala"},"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1529132135027_1661158394","id":"20171026-132209_703144307","dateCreated":"2018-06-16T15:55:35+0900","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:8011"}],"name":"Normal Spark","id":"2DFWS57NF","angularObjects":{"2DFWJWNJD:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}